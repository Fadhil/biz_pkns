- model_class = Course
.page-header
  %h1= t @course.name
%dl.dl-horizontal
  %dt
    %strong
      = t('course_type')
      \:
  %dd= @course.course_type
  %dt
    %strong
      = t('program')
      \:
  %dd= @course.program.name
  %dt
    %strong
      = t('description')
      \:
  %dd= @course.description
  %dt
    %strong
      = t('start_date')
      \:
  %dd= @course.start_date
  %dt
    %strong
      = t('end_date')
      \:
  %dd= @course.end_date
  %dt
    %strong
      = t('venue')
      \:
  %dd= @course.venue
  %dt
    %strong
      = t('pax')
      \:
  %dt
  %dd= @course.pax
  %dt
    %strong
      = t('status')
      \:
  %dd= !@course.status.blank? || @course.status? ? t('active') : t('inactive')

-if current_user
  - if !current_user.courses.include?(@course) && !current_user.admin?
    = form_tag user_course_registration_path({id: @course.id, user_id: current_user.id}), method: :put do
      = button_tag t('register_course'), data: { confirm: t('confirm_register_course') }, class: 'btn'

- if can? :manage, @course
  .form-actions

  = link_to t('edit', :default => t("helpers.links.edit")), |
    edit_course_path(@course), :class => 'btn'              |
  -#
  = link_to t('destroy', :default => t("helpers.links.destroy")),                                                 |
    course_path(@course),                                                                                         |
    :method => 'delete',                                                                                          |
    :data => { :confirm => t('confirm', :default => t("helpers.links.confirm", :default => t('are_you_sure'))) }, |
    :class => 'btn btn-danger'                                                           

  %br
  %br    
  - if @course.attendance_list
    - if @course.attendance_list.attendees.count > 0 && !@course.attendance_list.completed                   
      .preattendance
        %h4
          Preattendance List
        = button_tag t('print'), onclick:"print();", class: 'hidden-print'
        %table.table.table-striped
          %thead
            %tr
              %th{ :style => 'width: 5px;'}
                ID
              %th
                Name
              %th
                Email
              %th
                IC Number
          %tbody
            - @course.attendance_list.attendees.each_with_index do |attendee, index|
              %tr
                %td
                  = index + 1
                %td
                  - if attendee.name.nil?
                    = attendee.full_name
                  - else
                    = attendee.name
                %td
                  = attendee.email
                %td
                  = attendee.ic_number
                %td
                  - if !attendee.attended.nil? && !attendee.attendance_status.nil?
                    = t(attendee.attendance_status)
                  - else
                    = link_to t('present'), update_attendance_path(user_id: attendee.user_id, attendee_id: attendee.id, course_id: @course.id, attended: true, attendance_status: 'present'), method: :post, class: 'btn btn-mini'
                    = link_to t('not_present'), update_attendance_path(user_id: attendee.user_id, attendee_id: attendee.id, course_id: @course.id, attended: false, attendance_status: 'not_present'), method: :post, class: 'btn btn-mini' 
                    = link_to t('will_attend'), update_attendance_path(user_id: attendee.user_id, attendee_id: attendee.id, course_id: @course.id, attended: false, attendance_status: 'will_attend'), method: :post, class: 'btn btn-mini' 
                    = link_to t('cannot_attend'), update_attendance_path(user_id: attendee.user_id, attendee_id: attendee.id, course_id: @course.id, attended: false, attendance_status: 'cannot_attend'), method: :post, class: 'btn btn-mini'   
          %table.visible-print
            %tbody
              - 10.times do |n|
                %tr
                  %td{style:"border: 1px solid black;"}
                    =@course.attendance_list.attendees.count + n + 1
                  %td{style:"border: 1px solid black; width: 150px;"}
                
                  %td{style:"border: 1px solid black;width: 140px;"}
                                  
                  %td{style:"border: 1px solid black;width: 140px;"}
                                  
                  %td{style:"border: 1px solid black;width: 140px;"}
                    
          .row-fluid
            = nested_form_for @course.attendance_list do |f|
              = f.fields_for :attendees do |a|
                = a.text_field :first_name, value: t('first_name') if a.object.new_record?
                = a.text_field :last_name, value: t('last_name') if a.object.new_record?
                = a.text_field :email, value: t('email') if a.object.new_record?
                = a.text_field :ic_number, value: t('ic_number') if a.object.new_record?
                = a.link_to_remove t('remove'), class: 'btn btn-mini btn-danger' if a.object.new_record?
                = a.hidden_field :attended, value: 1
              = f.link_to_add t('add_attendee'), :attendees, class: 'btn btn-mini hidden-print'   
              = f.submit t('update'), class: 'hidden-print'   
            = form_for @course.attendance_list do |f|
              = f.hidden_field :completed, value: 1
              = f.submit t('end_course'), class: 'hidden-print'


        .span2
          %h5 
            = t('number_of_attendees')
        .span2
          %h5
            = "#{@course.attendance_list.attendees.count}/#{@course.attendance_list.max_attendees}"
